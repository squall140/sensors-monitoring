### 1. Background

Assume a scenario, there are a lot of sensors in a large scale factory, we need to monitor each sensor data so that can easily monitor the health for all of our machines. The amount of sensors is around 2000 at this time, also we need to consider a suitable solution if the amount increase a large number.

### 2. Constraint

- Development languages 
  - Python (Backend)
  - ReactJs (Frontend)

- Timeline 
  - A demo for beginning, all the works should be finished in a week
- Testing
  - Unit test & Api Test & Load Test
  - Unit Test report(generated by Pytest):  "./testcases/report.html" 
  - Load Test report(generated by JMeter):  "./loadtest/report_load_test_1000_threads_30min"
- Elegant deployment

### 3. Design

- Since we need to collect all of our sensors' data, the first comes to my mind is the network transfer. Based on this scenario, we need to choose a suitable network transfer protocol. From my understanding I think the best one is the MQTT protocol. Because its payload is very thin and light, allowing us to send and retrieve data to our server smoothly.

- We need a MQTT broker like a message queue, allow us to use the "pub/sub" feature to realize our goal. I decidee to use the "Mosquito" for basic scenario.

- Stability & Extensibility
  - As a message queue, Mosquitto can allow us to retrieve data from itself. It That means if the pub/sub services was down and restarted, it also can send/fetch data from the broker mainly because of the persistent feature. That is why we decided to set up an independent broker or a broker cluster for a better stability.
  - When we need to consider expanding our system in order to reach a better system throughput, we only need to focus on the cluster mode based on this infrastructure rather than rebuild all of our system skeletons. For example, if we need monitor more sensors, we can easily deploy a new subscriber to listen to any data from each sensor, publishing these data to the broker. 

### 4. Infrastructure Diagram

![img.png](img.png)

### 5. Deployment

- git clone & cd ./release

- docker-compose up -d 

  

  

  

  